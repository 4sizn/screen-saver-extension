---
phase: 01-foundation-&-activation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - public/icon/16.png
  - public/icon/32.png
  - public/icon/48.png
  - public/icon/128.png
  - public/sounds/click.mp3
autonomous: false

must_haves:
  truths:
    - "Extension icon displays in browser toolbar across Chrome, Firefox, Edge, Safari"
    - "Icon click activates screen saver with full-screen overlay"
    - "Icon click again deactivates screen saver"
    - "ESC key deactivates screen saver from overlay"
    - "Badge changes color (gray inactive, green active) on icon"
    - "Activation shows notification and plays sound"
  artifacts:
    - path: "public/icon/16.png"
      provides: "16x16 toolbar icon for standard DPI displays"
    - path: "public/icon/32.png"
      provides: "32x32 toolbar icon for high DPI displays"
    - path: "public/icon/48.png"
      provides: "48x48 icon for extension management page and notifications"
    - path: "public/icon/128.png"
      provides: "128x128 icon for Chrome Web Store and browser extension pages"
    - path: "public/sounds/click.mp3"
      provides: "Activation sound feedback (short click/pop)"
  key_links:
    - from: "wxt.config.ts"
      to: "public/icon/*.png"
      via: "manifest action.default_icon paths"
      pattern: "icon/16\\.png.*icon/32\\.png.*icon/48\\.png.*icon/128\\.png"
    - from: "entrypoints/background.ts"
      to: "public/sounds/click.mp3"
      via: "Audio playback on activation"
      pattern: "sounds/click\\.mp3"
    - from: "entrypoints/background.ts"
      to: "public/icon/48.png"
      via: "Notification icon reference"
      pattern: "icon/48\\.png"
---

<objective>
Add extension icon assets in multiple sizes for browser toolbar display and create an activation sound file. Then verify the complete activation/deactivation flow works correctly across all target browsers (Chrome, Firefox, Edge, Safari).

Purpose: Complete the Phase 1 foundation by adding visual and audio assets, then validate that the entire cross-browser activation system functions as specified.

Output: Extension icons visible in browser toolbar, activation sound plays on toggle, and cross-browser verification confirms all browsers support the activation mechanics.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-&-activation/01-CONTEXT.md
@.planning/phases/01-foundation-&-activation/01-RESEARCH.md
@.planning/phases/01-foundation-&-activation/01-01-SUMMARY.md
@.planning/phases/01-foundation-&-activation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create extension icon assets and activation sound</name>
  <files>
    public/icon/16.png
    public/icon/32.png
    public/icon/48.png
    public/icon/128.png
    public/sounds/click.mp3
  </files>
  <action>
Generate extension icon files in required sizes for browser toolbar display and create a short activation sound file.

**Create icon directory structure:**
```bash
mkdir -p public/icon
mkdir -p public/sounds
```

**Icon requirements:**
- 16x16 pixels - Standard DPI toolbar icon
- 32x32 pixels - High DPI (Retina) toolbar icon
- 48x48 pixels - Extension management page, notifications
- 128x128 pixels - Chrome Web Store, browser extension gallery pages

**Icon design:**
Generate a simple, recognizable icon representing a screen saver or display. Suggested design:
- Simple monitor/screen outline with a decorative element (star, moon, or landscape silhouette)
- Use a calming color palette (blues, purples, or greens)
- Ensure icon is clearly visible at 16x16 (smallest size)
- High contrast for visibility against both light and dark browser themes

Use an AI image generation tool or simple graphic design to create the icon, then export in the four required sizes as PNG files with transparency.

**Activation sound (click.mp3):**
Create or source a short (0.1-0.3 seconds), pleasant click or pop sound:
- Subtle, non-intrusive sound
- Clear audio feedback that activation occurred
- Low volume by default (background.ts sets volume to 0.5)
- MP3 format for broad browser compatibility
- Small file size (< 50KB)

Suggested sources:
- Generate using an online sound effect generator
- Use royalty-free sound libraries (freesound.org, zapsplat.com)
- Keep it minimal - single "click" or soft "pop" sound

**File placement:**
```
public/
├── icon/
│   ├── 16.png
│   ├── 32.png
│   ├── 48.png
│   └── 128.png
└── sounds/
    └── click.mp3
```

**Why these formats and sizes:**
- PNG with transparency: Adapts to both light and dark browser themes
- Multiple sizes: Different browsers request different sizes based on display DPI
- MP3 audio: Universally supported across all browsers and platforms
- Small file sizes: Faster extension installation, minimal storage footprint
  </action>
  <verify>
```bash
# Check all icon files exist
ls public/icon/16.png public/icon/32.png public/icon/48.png public/icon/128.png

# Check sound file exists
ls public/sounds/click.mp3

# Verify file sizes (icons should be small PNGs)
du -h public/icon/*.png
du -h public/sounds/click.mp3

# Build and check assets copied to output
npm run build
ls .output/chrome-mv3/icon/
ls .output/chrome-mv3/sounds/
```
  </verify>
  <done>
- public/icon/ directory contains 16.png, 32.png, 48.png, 128.png
- All icons are PNG format with transparency
- Icons are clearly visible and recognizable at smallest size (16x16)
- public/sounds/click.mp3 exists and is under 50KB
- Sound is 0.1-0.3 seconds duration, MP3 format
- Build copies assets to .output directory correctly
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 1 foundation: WXT framework with React + TypeScript, background service worker handling icon clicks, content script injecting full-screen Shadow DOM overlay, icon assets, and activation sound.

**Core functionality implemented:**
1. Icon click toggles activation on/off
2. Full-screen black overlay appears on activation
3. Badge color changes (gray inactive → green active)
4. Notification displays on activation with Korean text
5. Click sound plays on activation
6. ESC key deactivates from overlay
7. Icon click while active also deactivates
  </what-built>

  <how-to-verify>
**Prerequisites:**
1. Build the extension:
   ```bash
   cd /Users/hsshin-rsupport/Documents/lotus/screen-saver-web
   npm run build
   ```

2. Load extension in browsers:

   **Chrome/Edge:**
   - Navigate to `chrome://extensions`
   - Enable "Developer mode" (top right toggle)
   - Click "Load unpacked"
   - Select `.output/chrome-mv3` directory

   **Firefox:**
   - Navigate to `about:debugging#/runtime/this-firefox`
   - Click "Load Temporary Add-on"
   - Select any file in `.output/firefox-mv3` directory (e.g., manifest.json)

   **Safari:**
   - Build: `npm run build -- --browser safari`
   - Open Safari → Settings → Advanced → Enable "Show Develop menu"
   - Develop → Allow Unsigned Extensions
   - Safari → Settings → Extensions → Enable "Screen Saver"

**Test Procedure (perform on each browser):**

1. **Verify extension installed:**
   - [ ] Extension icon visible in browser toolbar
   - [ ] Icon shows gray dot badge (inactive state)
   - [ ] Hovering shows "Toggle Screen Saver" tooltip

2. **Test activation (icon click):**
   - [ ] Navigate to any website (e.g., google.com)
   - [ ] Click extension icon in toolbar
   - [ ] Full-screen black overlay appears immediately, covering entire page
   - [ ] Overlay shows placeholder text "Screen Saver Active" and "Press ESC to exit"
   - [ ] Icon badge changes from gray to green
   - [ ] Browser notification appears with Korean text "스크린세이버 활성화"
   - [ ] Short click sound plays (audible at ~50% volume)

3. **Test ESC key deactivation:**
   - [ ] With overlay active, press ESC key
   - [ ] Overlay disappears immediately
   - [ ] Original page content visible again
   - [ ] Icon badge changes from green back to gray
   - [ ] No notification or sound on deactivation (silent)

4. **Test icon click deactivation:**
   - [ ] Click extension icon to activate (overlay appears, green badge)
   - [ ] Click extension icon again while active
   - [ ] Overlay disappears immediately
   - [ ] Icon badge changes from green back to gray
   - [ ] No notification or sound on deactivation (silent)

5. **Test across multiple tabs:**
   - [ ] Open two tabs with different websites
   - [ ] Activate screen saver in tab 1 (green badge on icon)
   - [ ] Switch to tab 2 - screen saver should NOT be active there
   - [ ] Activate in tab 2 (now both tabs have active screen savers)
   - [ ] Switch back to tab 1 - should still be active
   - [ ] Deactivate tab 1, switch to tab 2 - should still be active

6. **Test overlay isolation:**
   - [ ] Visit a complex website with heavy CSS (gmail.com, facebook.com, or notion.so)
   - [ ] Activate screen saver
   - [ ] Verify overlay appears ON TOP of all page content (no page elements visible through/above overlay)
   - [ ] Verify overlay styling unaffected by page CSS (black background, white text, centered)

**Cross-browser comparison:**
Test on at least Chrome and one other browser (Firefox or Edge). Verify:
- [ ] Icon appearance consistent
- [ ] Badge color changes work identically
- [ ] Overlay rendering identical (same black background, same text styling)
- [ ] Notification appears in both browsers (may look different due to OS styling)
- [ ] Sound plays in both browsers
- [ ] ESC key handling works in both browsers

**Expected results:**
- All activation/deactivation mechanisms work reliably
- Overlay appears instantly (< 200ms after icon click)
- Badge state always reflects activation state correctly
- No JavaScript errors in browser console (check DevTools → Console)
- Sound plays without errors (if no audio, not a failure - check volume)
  </how-to-verify>

  <resume-signal>
Type one of the following:

**If all tests pass:** "approved" or "all tests pass"

**If issues found:** Describe the specific failure:
- Which browser?
- Which test step failed?
- What happened vs what was expected?
- Any console errors?

Example issue report:
```
Firefox - Step 2: Overlay appears but badge stays gray (doesn't turn green)
Console error: "browser.action.setBadgeBackgroundColor is not a function"
```

I will diagnose and fix any issues before proceeding to Phase 2.
  </resume-signal>
</task>

</tasks>

<verification>
After Task 1 (automated verification):

1. **Asset files exist:**
   ```bash
   ls public/icon/16.png public/icon/32.png public/icon/48.png public/icon/128.png
   ls public/sounds/click.mp3
   ```

2. **Assets copied to build output:**
   ```bash
   npm run build
   ls .output/chrome-mv3/icon/
   ls .output/chrome-mv3/sounds/
   ```

3. **References in code correct:**
   ```bash
   # Icon paths in config
   grep "icon/.*png" wxt.config.ts

   # Sound path in background script
   grep "sounds/click.mp3" entrypoints/background.ts
   ```

After Task 2 (human verification):

Human confirms all activation/deactivation flows work across browsers, or reports specific issues for remediation.
</verification>

<success_criteria>
1. Extension icons exist in all required sizes (16, 32, 48, 128 PNG)
2. Icons are visible and recognizable at smallest size
3. Activation sound (click.mp3) exists and is under 50KB
4. Build process copies assets to output directory correctly
5. Extension loads in Chrome, Firefox, Edge, and Safari without errors
6. Icon click activates screen saver (overlay + badge + notification + sound)
7. Icon click while active deactivates (overlay removed, badge reset, silent)
8. ESC key deactivates from overlay (silent)
9. Badge color changes correctly (gray inactive, green active)
10. Overlay appears on top of all page content with correct styling
11. Per-tab activation state works correctly (multiple tabs independent)
12. No console errors during activation/deactivation flows
13. Cross-browser behavior is consistent (Chrome, Firefox, Edge, Safari)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-&-activation/01-03-SUMMARY.md`

Include:
- What was built (icon assets, sound file)
- Verification results (which browsers tested, any issues found)
- Cross-browser compatibility notes
- Complete activation/deactivation flow description
- Files created
- Phase 1 completion status (foundation ready for Phase 2)
- Any known limitations or browser-specific quirks discovered
</output>
