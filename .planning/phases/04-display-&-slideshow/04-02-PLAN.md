---
phase: 04-display-&-slideshow
plan: 02
type: execute
wave: 2
depends_on: [04-01]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User sees randomly selected image when screen saver activates"
    - "Cover fit mode fills entire screen (crops if needed)"
    - "Contain fit mode shows full image with letterboxing"
    - "Background color visible in contain mode letterboxing"
    - "Disabled images never appear in rotation"
    - "Default images always available (cannot be disabled)"
  artifacts:
    - path: "entrypoints/content/ScreenSaverOverlay.tsx"
      provides: "Working image display component"
      status: "implemented in 04-01"
  key_links:
    - from: "ScreenSaverOverlay display"
      to: "user perception"
      via: "visual confirmation of requirements"
      pattern: "human verification"
---

<objective>
Verify that screen saver displays images correctly with user-configured fit modes and background colors across different image aspect ratios and settings combinations.

Purpose: Confirms Phase 4 requirements (DISP-01 through DISP-05) are met before moving to Phase 5

Output: Human-verified confirmation that image display works as specified
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/04-display-&-slideshow/04-CONTEXT.md

## Prior Plan
@.planning/phases/04-display-&-slideshow/04-01-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Full-screen image overlay displaying randomly selected enabled images with user-configurable fit mode (cover/contain) and background color.

Implementation completed in Plan 04-01:
- Image loading from IndexedDB with random selection
- Display settings integration (fit mode, background color)
- Loading and error state handling
- Blob URL lifecycle management
  </what-built>

  <how-to-verify>
## Preparation

1. **Load extension with latest changes:**
```bash
cd /Users/hsshin-rsupport/Documents/lotus/screen-saver-web
npm run dev
```

2. **Open options page to verify image collection:**
   - Click extension icon → right-click → "Options"
   - OR navigate to `chrome://extensions` → Screen Saver → Options
   - Confirm 15 default images are visible
   - Confirm at least some images are enabled (toggle switches ON)

## Verification Steps

### Test 1: Basic Display
1. Open any browser tab (e.g., google.com)
2. Click extension icon to activate screen saver
3. **Expected:** Full-screen overlay displays with one random image
4. **Expected:** Image fills entire screen (default cover mode)
5. Press ESC to deactivate
6. **Expected:** Overlay disappears, returns to original page

### Test 2: Cover Fit Mode
1. Open options page
2. In Display Settings section, select "Cover" fit mode
3. Open new tab (e.g., news site)
4. Activate screen saver via extension icon
5. **Expected:** Image fills entire screen, may crop to fit
6. **Expected:** No letterboxing (background color not visible)
7. Test with several images (deactivate ESC, reactivate icon multiple times)
8. **Expected:** Different random images each activation
9. Deactivate with ESC

### Test 3: Contain Fit Mode with Background Color
1. Open options page
2. Select "Contain" fit mode
3. Select bright background color (e.g., red #FF0000)
4. Activate screen saver on any tab
5. **Expected:** Full image visible (no cropping)
6. **Expected:** Red background visible on sides or top/bottom (letterboxing)
7. Deactivate with ESC

### Test 4: Different Background Colors
1. Open options page, keep "Contain" mode
2. Try different background colors:
   - Black (#000000) - should see black letterboxing
   - White (#FFFFFF) - should see white letterboxing
   - Blue (#0000FF) - should see blue letterboxing
3. For each color: activate screen saver, verify background color visible
4. Deactivate with ESC after each test

### Test 5: Image Enable/Disable
1. Open options page
2. Disable ALL custom images (if any uploaded)
3. Note: Default images cannot be disabled (switches should be always ON)
4. Activate screen saver
5. **Expected:** Screen saver still displays (default images always enabled)
6. Try activating multiple times
7. **Expected:** Different default images appear randomly

### Test 6: Multiple Activations (Random Selection)
1. Activate and deactivate screen saver 5-10 times
2. **Expected:** Different images appear (proves random selection working)
3. **Expected:** No memory issues (blob URL cleanup working)
4. **Expected:** No console errors

### Test 7: Loading State (if visible)
1. Activate screen saver
2. **Expected:** Either instant image display OR brief "Loading..." text
3. **Expected:** Smooth fade-in of image (no flicker)

### Test 8: Error Handling (optional stress test)
1. Open browser DevTools → Application → IndexedDB
2. Manually delete "screen-saver-images" database (optional destructive test)
3. Reload extension
4. Activate screen saver
5. **Expected:** Either error state message OR default images load automatically

## Success Criteria

All tests pass with expected behavior:
- ✓ Screen saver displays full-screen overlay
- ✓ Random image selected from enabled collection
- ✓ Cover mode fills screen (may crop)
- ✓ Contain mode shows full image with letterboxing
- ✓ Background color visible in contain mode
- ✓ ESC key deactivates correctly
- ✓ Different images on multiple activations
- ✓ Default images always available
- ✓ No console errors during normal operation
- ✓ No memory leaks after multiple activations

## Common Issues

**Issue:** Image not displaying, shows "Loading..." forever
- **Check:** Browser console for errors
- **Check:** IndexedDB has images (DevTools → Application → IndexedDB)
- **Fix:** Reload extension, verify 15 defaults loaded on install

**Issue:** Same image appears every time (not random)
- **Check:** Multiple images are enabled in options page
- **Fix:** Ensure at least 2-3 images enabled, try activating 5+ times

**Issue:** Wrong fit mode (cover when contain selected)
- **Check:** Settings saved correctly (reload options page, verify selection)
- **Fix:** Select fit mode again, wait 1 second for auto-save

**Issue:** Background color not visible
- **Check:** Fit mode is "Contain" (cover mode never shows background)
- **Check:** Image aspect ratio different from screen (tall or wide image)
- **Try:** Very bright color (red, yellow) to make it obvious
  </how-to-verify>

  <resume-signal>
After completing verification steps, respond with:

**If all tests pass:** "approved" or "all working correctly"

**If issues found:** Describe specific failing test and observed behavior, e.g.:
- "Test 3 failed - background color not visible in contain mode"
- "Test 6 failed - same image appears every time"
- "Test 1 failed - no image displays, console error: [error message]"

Claude will diagnose and fix issues before proceeding.
  </resume-signal>
</task>

</tasks>

<verification>
Human verification confirms:
- Visual display correctness across fit modes
- Random selection working correctly
- Background color visible in appropriate mode
- Error states handled gracefully
- No console errors or memory leaks
</verification>

<success_criteria>
Plan complete when:
- [ ] Human completes all 8 verification tests
- [ ] All expected behaviors observed
- [ ] No blocking issues found
- [ ] Phase 4 requirements DISP-01 through DISP-05 validated
- [ ] Approval given to proceed to Phase 5
</success_criteria>

<output>
After completion, create `.planning/phases/04-display-&-slideshow/04-02-SUMMARY.md`
</output>
