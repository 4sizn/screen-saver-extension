---
phase: 03-settings-infrastructure
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - entrypoints/options/components/ImageList.tsx
  - lib/imageStorage.ts
autonomous: true

must_haves:
  truths:
    - "User can toggle individual images on/off"
    - "Toggle state persists in IndexedDB"
    - "Disabled images visually distinct from enabled"
  artifacts:
    - path: "entrypoints/options/components/ImageList.tsx"
      provides: "Image list with enable/disable toggle switches"
      min_lines: 150
      contains: "Switch"
    - path: "lib/imageStorage.ts"
      provides: "toggleImageEnabled function"
      exports: ["toggleImageEnabled"]
  key_links:
    - from: "ImageList.tsx Switch"
      to: "toggleImageEnabled"
      via: "onCheckedChange handler"
      pattern: "onCheckedChange.*toggleImageEnabled"
    - from: "toggleImageEnabled"
      to: "IndexedDB"
      via: "store.put after toggle"
      pattern: "image\\.isEnabled = !image\\.isEnabled"
---

<objective>
Add enable/disable toggle switches to image management UI for controlling which images appear in screen saver rotation.

Purpose: Allow users to temporarily exclude images from screen saver without deleting them. Toggles persist state in IndexedDB and provide visual feedback.

Output: Updated ImageList component with Switch controls for each image, wired to toggleImageEnabled function from lib/imageStorage.ts.
</objective>

<execution_context>
@/Users/hsshin-rsupport/Documents/lotus/screen-saver-web/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hsshin-rsupport/Documents/lotus/screen-saver-web/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/hsshin-rsupport/Documents/lotus/screen-saver-web/.planning/PROJECT.md
@/Users/hsshin-rsupport/Documents/lotus/screen-saver-web/.planning/ROADMAP.md
@/Users/hsshin-rsupport/Documents/lotus/screen-saver-web/.planning/STATE.md
@/Users/hsshin-rsupport/Documents/lotus/screen-saver-web/.planning/phases/03-settings-infrastructure/03-CONTEXT.md
@/Users/hsshin-rsupport/Documents/lotus/screen-saver-web/.planning/phases/03-settings-infrastructure/03-RESEARCH.md

## Prior Phase Context

From Phase 2 (02-04):
- ImageList component already exists with drag-and-drop reordering
- Uses @dnd-kit for sortable list
- Displays thumbnails with object URLs
- Shows delete button (only for non-default images)
- Triple visual indicator for default images (badge, ring, icon)

From Phase 3 Plan 1:
- ImageRecord now has isEnabled: boolean field
- toggleImageEnabled function available in lib/imageStorage.ts
- Migration defaults existing images to enabled: true

From Phase 3 Plan 2 (parallel):
- Shadcn Switch component available in components/ui/switch.tsx
- Label component available for accessibility

## Current Files

@/Users/hsshin-rsupport/Documents/lotus/screen-saver-web/entrypoints/options/components/ImageList.tsx
@/Users/hsshin-rsupport/Documents/lotus/screen-saver-web/lib/imageStorage.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Switch component to ImageList for enable/disable toggle</name>
  <files>entrypoints/options/components/ImageList.tsx</files>
  <action>
Update the ImageList component to display a Switch control for each image that toggles the isEnabled state.

**Import additions at top of file:**
```typescript
import { Switch } from '@/components/ui/switch';
import { Label } from '@/components/ui/label';
import { toggleImageEnabled } from '@/lib/imageStorage';
```

**In the SortableImage component (or wherever individual image items render):**

Find the section that renders each image item (likely inside a map function). Currently it shows:
- Thumbnail with object URL
- Image name
- Delete button (if not default)
- Default indicators (if default)

Add a Switch control BEFORE the delete button:

```typescript
{/* Enable/Disable Toggle */}
<div className="flex items-center gap-2">
  <Switch
    id={`enable-${image.id}`}
    checked={image.isEnabled}
    onCheckedChange={async (checked) => {
      await toggleImageEnabled(image.id);
      // Refresh list to show updated state
      loadImages();
    }}
  />
  <Label
    htmlFor={`enable-${image.id}`}
    className="text-sm cursor-pointer"
  >
    {image.isEnabled ? 'Enabled' : 'Disabled'}
  </Label>
</div>
```

**Visual treatment for disabled images (optional but recommended):**

In the container div for each image, add conditional opacity:

```typescript
<div className={cn(
  "relative rounded-lg border p-3",
  !image.isEnabled && "opacity-60" // Visual feedback for disabled state
)}>
```

**Position in layout:**
Place the Switch control in a logical position. Suggested layout for each image item:

```
+------------------------------------------+
| [Thumbnail]  Image Name                 |
|              [●] Enabled  [Delete]      |
|              (switch)                   |
+------------------------------------------+
```

Or if you prefer inline:

```
+------------------------------------------+
| [Thumbnail] | Image Name                |
|             | [●] Enabled | [Delete]    |
+------------------------------------------+
```

Choose the layout that fits the existing ImageList design - consistency with current structure is more important than a specific layout.

**Key implementation notes:**
- Switch uses `checked` prop (controlled component) bound to image.isEnabled
- onCheckedChange calls toggleImageEnabled then refreshes list via loadImages()
- Label htmlFor matches Switch id for accessibility (clicking label toggles switch)
- Label text changes based on state ("Enabled" vs "Disabled") for clarity
- Optional opacity on disabled images provides visual distinction without being intrusive

**Why NOT use visual overlay on thumbnail:**
Research recommends Switch control only, no grayscale/overlay on thumbnail. Visual overlay creates ambiguity (disabled vs poor quality?). Switch clearly indicates state.
  </action>
  <verify>
npm run type-check
npm run dev
# Manual verification in browser:
# 1. Open options page
# 2. Verify each image has a Switch control
# 3. Toggle switch - state should flip
# 4. Refresh page - toggle state should persist
# 5. Check DevTools IndexedDB - image record should show isEnabled: false for toggled-off images
  </verify>
  <done>
- ImageList component imports Switch, Label, and toggleImageEnabled
- Each image item renders a Switch control bound to image.isEnabled
- Switch onCheckedChange calls toggleImageEnabled and refreshes list
- Label properly associated with Switch via htmlFor/id
- Toggling switch updates IndexedDB (verified in DevTools)
- Toggle state persists across page refresh
- TypeScript compilation succeeds
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify toggleImageEnabled function exists in imageStorage.ts</name>
  <files>lib/imageStorage.ts</files>
  <action>
This task verifies that the toggleImageEnabled function was created in Plan 03-01 Task 1.

**Check that lib/imageStorage.ts exports:**

```typescript
export async function toggleImageEnabled(id: string): Promise<void>
```

**Expected implementation:**
- Opens readwrite transaction
- Gets image record by id
- Flips isEnabled boolean: `image.isEnabled = !image.isEnabled`
- Puts updated record back to IndexedDB
- Promise-based with native IndexedDB API (no idb library)

**If function is missing:**
Add the function as specified in Plan 03-01 Task 1:

```typescript
/**
 * Toggle image enabled state for rotation inclusion
 * @param id - Image identifier
 */
export async function toggleImageEnabled(id: string): Promise<void> {
  const db = await initDB();
  const tx = db.transaction(STORE_NAME, 'readwrite');
  const store = tx.objectStore(STORE_NAME);

  const image = await new Promise<ImageRecord>((resolve, reject) => {
    const request = store.get(id);
    request.onsuccess = () => resolve(request.result);
    request.onerror = () => reject(request.error);
  });

  if (image) {
    image.isEnabled = !image.isEnabled;
    await new Promise<void>((resolve, reject) => {
      const request = store.put(image);
      request.onsuccess = () => resolve();
      request.onerror = () => reject(request.error);
    });
  }
}
```

**If function already exists from 03-01:**
No action needed - verify it type-checks and proceed.

**Why this verification task:**
Plans 03-02 and 03-03 run in parallel (both Wave 2). If 03-03 executes first or simultaneously, toggleImageEnabled might not exist yet. This task ensures the function is available before ImageList tries to use it.
  </action>
  <verify>
cat lib/imageStorage.ts | grep -A 20 "toggleImageEnabled"
npm run type-check
  </verify>
  <done>
- toggleImageEnabled function exists in lib/imageStorage.ts
- Function signature matches: `toggleImageEnabled(id: string): Promise<void>`
- Implementation uses native IndexedDB API
- Function properly exported
- TypeScript compilation succeeds
  </done>
</task>

</tasks>

<verification>
**Functional verification:**
1. Each image in ImageList shows a Switch control
2. Switch reflects current isEnabled state (on for enabled, off for disabled)
3. Clicking switch toggles state immediately
4. Toggled state persists across page refresh
5. IndexedDB shows correct isEnabled value in DevTools

**Visual verification:**
- Switch control is clearly visible and clickable
- Label text ("Enabled"/"Disabled") provides clarity
- Disabled images show subtle opacity reduction (if implemented)
- Switch doesn't conflict with drag-and-drop interaction
- Switch doesn't interfere with delete button

**Type safety:**
- npm run type-check passes
- ImageRecord.isEnabled properly typed as boolean
- toggleImageEnabled import resolves correctly

**Accessibility:**
- Label htmlFor associates with Switch id
- Clicking label toggles switch
- Keyboard navigation works (Tab to switch, Space to toggle)
</verification>

<success_criteria>
- User can toggle individual images on/off via Switch controls
- Toggle state persists in IndexedDB across sessions
- ImageList refreshes to show updated state after toggle
- No TypeScript or React errors
- Requirement SET-02 satisfied (enable/disable specific images)
- Combined with Plans 03-01 and 03-02, all Phase 3 requirements (SET-01 through SET-05) complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-settings-infrastructure/03-03-SUMMARY.md`
</output>
