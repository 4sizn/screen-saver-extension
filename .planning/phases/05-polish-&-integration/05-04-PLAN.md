---
phase: 05-polish-&-integration
plan: 04
type: execute
wave: 4
depends_on: ["05-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Extension works identically across Chrome, Firefox, and Edge"
    - "All activation, deactivation, and display flows work without errors"
    - "Image management UI works reliably across browsers"
    - "Settings persist correctly and take effect in all browsers"
    - "No console errors in any target browser"
  artifacts:
    - path: ".output/screen-saver-{version}-chrome.zip"
      provides: "Verified Chrome package ready for submission"
      tested: true
    - path: ".output/screen-saver-{version}-firefox.zip"
      provides: "Verified Firefox package ready for submission"
      tested: true
    - path: ".output/screen-saver-{version}-edge.zip"
      provides: "Verified Edge package ready for submission"
      tested: true
  key_links:
    - from: "Chrome extension"
      to: "Cross-browser compatibility"
      via: "Same functionality across all browsers"
      pattern: "activation.*deactivation.*identical"
    - from: "All browsers"
      to: "Store submission readiness"
      via: "Manual verification complete, no critical issues"
      pattern: "approved.*ready.*submission"
---

<objective>
Conduct comprehensive manual testing across all target browsers (Chrome, Firefox, Edge) to verify cross-browser compatibility and readiness for store submission.

Purpose: Final quality gate before public distribution to ensure users have consistent experience regardless of browser choice.

Output: User-approved verification confirming extension works correctly across all target browsers without critical issues.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/05-polish-&-integration/05-RESEARCH.md
@.planning/phases/05-polish-&-integration/05-01-SUMMARY.md
@.planning/phases/05-polish-&-integration/05-02-SUMMARY.md
@.planning/phases/05-polish-&-integration/05-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Screen Saver browser extension with:
- 15 Unsplash nature landscape default images (Phase 5 Plan 1)
- Audio autoplay policy compliance (no automatic sound, Phase 5 Plan 1)
- Production build verification (Phase 5 Plan 2)
- Browser-specific distribution packages for Chrome, Firefox, Edge (Phase 5 Plan 3)
- Privacy policy and store listing materials (Phase 5 Plan 3)
- All Phase 1-4 functionality: activation, deactivation, image management, settings, display
  </what-built>
  <how-to-verify>
**Comprehensive cross-browser verification testing:**

This is the final quality gate before public distribution. Test methodically across all browsers using the browser-specific packages created in 05-03.

---

## Setup: Install Extension in Each Browser

### Chrome Testing Setup
```bash
# Use Chrome ZIP package
unzip .output/screen-saver-*-chrome.zip -d /tmp/chrome-test

# In Chrome:
# 1. Navigate to chrome://extensions/
# 2. Enable "Developer mode" (top right toggle)
# 3. Click "Load unpacked"
# 4. Select: /tmp/chrome-test/
# 5. Verify extension loads without manifest errors
```

### Firefox Testing Setup
```bash
# Use Firefox ZIP package
unzip .output/screen-saver-*-firefox.zip -d /tmp/firefox-test

# In Firefox:
# 1. Navigate to about:debugging#/runtime/this-firefox
# 2. Click "Load Temporary Add-on"
# 3. Select: /tmp/firefox-test/manifest.json
# 4. Verify extension loads without manifest errors
```

### Edge Testing Setup
```bash
# Use Edge ZIP package
unzip .output/screen-saver-*-edge.zip -d /tmp/edge-test

# In Microsoft Edge:
# 1. Navigate to edge://extensions/
# 2. Enable "Developer mode" (left sidebar toggle)
# 3. Click "Load unpacked"
# 4. Select: /tmp/edge-test/
# 5. Verify extension loads without manifest errors
```

---

## Test Matrix: Verify in ALL Three Browsers

For each test below, verify in **Chrome**, **Firefox**, AND **Edge**. Mark results for each browser.

### 1. Installation & First Run

| Test | Chrome | Firefox | Edge |
|------|--------|---------|------|
| Extension appears in extensions list | [ ] | [ ] | [ ] |
| Extension icon visible in toolbar | [ ] | [ ] | [ ] |
| Badge shows gray (inactive) on first load | [ ] | [ ] | [ ] |
| No console errors in service worker | [ ] | [ ] | [ ] |
| DevTools IndexedDB shows 15 default images | [ ] | [ ] | [ ] |

**How to check IndexedDB:**
- Chrome/Edge: DevTools (F12) > Application tab > IndexedDB > screen-saver-images > images
- Firefox: DevTools (F12) > Storage tab > IndexedDB > screen-saver-images > images

**Expected:** 15 entries with isDefault: true, names "Default Nature 1" through "Default Nature 15"

---

### 2. Activation Flow

Navigate to any web page (e.g., https://example.com) and test activation:

| Test | Chrome | Firefox | Edge |
|------|--------|---------|------|
| Click icon → Full-screen overlay appears | [ ] | [ ] | [ ] |
| Random Unsplash nature image displayed | [ ] | [ ] | [ ] |
| Image quality good (not pixelated/broken) | [ ] | [ ] | [ ] |
| Badge turns green | [ ] | [ ] | [ ] |
| Notification displays (Korean text) | [ ] | [ ] | [ ] |
| NO audio autoplay errors in console | [ ] | [ ] | [ ] |
| Overlay covers entire viewport | [ ] | [ ] | [ ] |

**Expected notification text:** "스크린세이버 활성화" / "ESC 키를 눌러 종료하세요."

**Console check:** NO "NotAllowedError" or audio-related errors (audio removed in 05-01)

---

### 3. Deactivation Flow

Test both deactivation methods:

| Test | Chrome | Firefox | Edge |
|------|--------|---------|------|
| Press ESC → Overlay disappears | [ ] | [ ] | [ ] |
| Badge turns gray after ESC | [ ] | [ ] | [ ] |
| Click icon → Activate again | [ ] | [ ] | [ ] |
| Click icon → Deactivate | [ ] | [ ] | [ ] |
| Badge turns gray after icon click | [ ] | [ ] | [ ] |
| No notification on deactivation (silent) | [ ] | [ ] | [ ] |

---

### 4. Image Management (Options Page)

Access options page via:
- Right-click icon > Options
- OR browser extensions page > Extension options

| Test | Chrome | Firefox | Edge |
|------|--------|---------|------|
| Options page opens in new tab | [ ] | [ ] | [ ] |
| 15 default images visible with thumbnails | [ ] | [ ] | [ ] |
| Default badge overlay on all defaults | [ ] | [ ] | [ ] |
| Upload new image → appears in list | [ ] | [ ] | [ ] |
| Upload shows loading state | [ ] | [ ] | [ ] |
| Image compression works (check file size) | [ ] | [ ] | [ ] |
| Delete custom image → removed from list | [ ] | [ ] | [ ] |
| Cannot delete default images (button disabled) | [ ] | [ ] | [ ] |
| Drag to reorder → updates order | [ ] | [ ] | [ ] |

**Upload test:** Upload a large image (>2MB). Verify:
- Loading indicator appears during compression
- Final size in IndexedDB is <500KB (compression working)
- Thumbnail displays correctly

---

### 5. Display Settings

In options page, test settings controls:

| Test | Chrome | Firefox | Edge |
|------|--------|---------|------|
| Fit mode: Cover selected by default | [ ] | [ ] | [ ] |
| Change to Contain → saves immediately | [ ] | [ ] | [ ] |
| Background color picker visible | [ ] | [ ] | [ ] |
| Change background color → saves (debounced) | [ ] | [ ] | [ ] |
| Close options page, reopen → settings persist | [ ] | [ ] | [ ] |

**Settings persistence test:**
1. Change fit mode to Contain
2. Change background color to red (#FF0000)
3. Close options page
4. Reopen options page
5. Verify: Fit mode still Contain, background color still red

---

### 6. Settings Take Effect

Test that settings changes affect display:

| Test | Chrome | Firefox | Edge |
|------|--------|---------|------|
| Set fit mode: Cover → Activate → Image fills screen | [ ] | [ ] | [ ] |
| Set fit mode: Contain → Activate → Image has letterboxing | [ ] | [ ] | [ ] |
| Set background color: Red → Activate with Contain → Red visible | [ ] | [ ] | [ ] |
| Disable all custom images → Activate → Default images still work | [ ] | [ ] | [ ] |
| Disable some default images → Activate → Only enabled images appear | [ ] | [ ] | [ ] |

**Visual verification:**
- **Cover mode:** Image should fill entire screen, may crop edges
- **Contain mode:** Image preserves aspect ratio, background color visible on sides/top/bottom

---

### 7. Multi-Tab Behavior

Test per-tab activation state management:

| Test | Chrome | Firefox | Edge |
|------|--------|---------|------|
| Tab A: Activate → Tab B: Still inactive | [ ] | [ ] | [ ] |
| Tab A: Active, Tab B: Activate → Both active independently | [ ] | [ ] | [ ] |
| Tab A: Badge green, Tab B: Badge green (correct states) | [ ] | [ ] | [ ] |
| Tab A: Deactivate → Tab B: Still active | [ ] | [ ] | [ ] |
| Close Tab A (active) → No impact on Tab B | [ ] | [ ] | [ ] |

**Expected:** Each tab maintains independent activation state. Badge color reflects per-tab state.

---

### 8. Service Worker Lifecycle (Chrome/Edge only)

Test service worker restart behavior:

| Test | Chrome | Edge |
|------|--------|------|
| Activate screen saver | [ ] | [ ] |
| Wait 2 minutes (service worker terminates) | [ ] | [ ] |
| Click icon → Deactivates correctly | [ ] | [ ] |
| Badge state correct after restart | [ ] | [ ] |
| Activate again → Works normally | [ ] | [ ] |

**How to verify service worker terminated:**
- Chrome/Edge: Go to chrome://extensions/ or edge://extensions/
- Click "service worker" link
- Watch console - will show "Service worker stopped" after ~30-60 seconds of inactivity

**Note:** Firefox uses persistent background scripts (MV2), so this test only applies to Chrome/Edge (MV3).

---

### 9. Edge Cases

Test unusual but valid scenarios:

| Test | Chrome | Firefox | Edge |
|------|--------|---------|------|
| Multiple browser windows → Each independent | [ ] | [ ] | [ ] |
| Incognito/Private mode → Extension works (if enabled) | [ ] | [ ] | [ ] |
| Restart browser → Settings persist | [ ] | [ ] | [ ] |
| Disable extension, re-enable → IndexedDB preserved | [ ] | [ ] | [ ] |
| Upload image with special characters in filename → Works | [ ] | [ ] | [ ] |

**Incognito note:** Extension may not be enabled in incognito by default. Enable it first:
- Chrome/Edge: Extension settings > "Allow in Incognito"
- Firefox: about:addons > Extension > Details > "Run in Private Windows: Allow"

---

### 10. Performance Verification

Use browser task managers to check resource usage:

| Metric | Chrome | Firefox | Edge | Target |
|--------|--------|---------|------|--------|
| Memory (idle) | [ ] MB | [ ] MB | [ ] MB | <15MB |
| Memory (active) | [ ] MB | [ ] MB | [ ] MB | <20MB |
| CPU (idle) | [ ] % | [ ] % | [ ] % | 0% |
| CPU (active) | [ ] % | [ ] % | [ ] % | <5% |

**How to measure:**
- Chrome/Edge: Press Shift+Esc (Task Manager) > Find "Extension: Screen Saver"
- Firefox: about:performance > Find extension

**Let browser run for 5 minutes idle, then check memory.** Memory leaks will show gradual increase.

---

### 11. Console Error Audit

Check for errors in all console contexts:

| Context | Chrome | Firefox | Edge |
|---------|--------|---------|------|
| Web page console (F12 on any page) | [ ] | [ ] | [ ] |
| Service worker console (extensions page) | [ ] | [ ] | [ ] |
| Options page console (F12 on options) | [ ] | [ ] | [ ] |

**Expected:** NO errors. Warnings acceptable if non-critical (e.g., browser-specific info messages).

**Specific checks:**
- [ ] NO "NotAllowedError" (audio removed in 05-01)
- [ ] NO "Failed to load resource" (all web_accessible_resources correct)
- [ ] NO "IndexedDB transaction error" (storage operations working)
- [ ] NO "Uncaught TypeError" (code not breaking)

---

### 12. Screenshot Capture (for Store Listings)

While testing, capture screenshots for store submission (see STORE_LISTING.md):

**Required screenshots:**
1. **Screen saver active** (1280x800) - showing Unsplash nature image
2. **Options page - Image list** (1280x800) - showing thumbnails and default badges
3. **Options page - Settings** (1280x800) - showing fit mode and color picker
4. **Extension icon with badge** (optional) - toolbar showing green active badge

Save screenshots to: `.planning/phases/05-polish-&-integration/screenshots/`

---

## Cross-Browser Compatibility Summary

After completing all tests, fill out browser compatibility matrix:

| Feature | Chrome | Firefox | Edge | Issues |
|---------|--------|---------|------|--------|
| Installation | ✓ / ✗ | ✓ / ✗ | ✓ / ✗ | |
| Activation | ✓ / ✗ | ✓ / ✗ | ✓ / ✗ | |
| Deactivation | ✓ / ✗ | ✓ / ✗ | ✓ / ✗ | |
| Image Management | ✓ / ✗ | ✓ / ✗ | ✓ / ✗ | |
| Settings | ✓ / ✗ | ✓ / ✗ | ✓ / ✗ | |
| Display Modes | ✓ / ✗ | ✓ / ✗ | ✓ / ✗ | |
| Performance | ✓ / ✗ | ✓ / ✗ | ✓ / ✗ | |
| No Console Errors | ✓ / ✗ | ✓ / ✗ | ✓ / ✗ | |

**Overall Compatibility:** ✓ All browsers working / ✗ Critical issues found

---

## Expected Results

**All tests pass across Chrome, Firefox, and Edge with:**
- Identical functionality (no browser-specific bugs)
- No critical console errors
- Performance within targets (Memory <15MB idle, CPU 0% idle)
- Settings persistence working
- Visual quality excellent (Unsplash images, smooth transitions)
- Ready for public distribution

**If Critical Issues Found:**

Report specific failures with:
1. **Which browser(s)** affected
2. **Which test(s)** failed
3. **Exact error messages** (copy from console)
4. **Steps to reproduce**
5. **Screenshots** if visual issues

**Common browser-specific issues to watch for:**
- Firefox: IndexedDB quota prompts (may need user approval)
- Firefox: Notification permission prompts (different UX from Chrome)
- Edge: Very similar to Chrome, but occasionally different CSP behavior
- Chrome: Service worker lifecycle may cause state loss if not handled

---

## Final Approval

After completing all tests, provide summary:

**All browsers working?** Yes / No

**Critical issues found?** None / [List issues]

**Performance acceptable?** Yes / No

**Ready for store submission?** Yes / No

**Screenshots captured?** Yes / No (saved to .planning/phases/05-polish-&-integration/screenshots/)

  </how-to-verify>
  <resume-signal>
Provide cross-browser test results:

**Format:**
```
VERIFICATION COMPLETE

Chrome: [PASS / FAIL + issues]
Firefox: [PASS / FAIL + issues]
Edge: [PASS / FAIL + issues]

Critical issues: [None / List]
Performance: [Within targets / Issues]
Screenshots: [Captured / Not yet]

APPROVED: [Yes / No]
```

**If APPROVED:** Phase 5 complete, ready for store submission.

**If issues found:** Will create gap closure plans to address specific browser compatibility issues before approval.
  </resume-signal>
</task>

</tasks>

<verification>
**Cross-Browser Compatibility Verification:**

All Phase 5 success criteria (from ROADMAP.md) must be validated:
1. ✓ Extension works identically on Chrome, Firefox, Edge (and Safari if applicable)
2. ✓ All activation, deactivation, and display flows work without errors
3. ✓ Image management (upload, delete, reorder) works reliably
4. ✓ Settings persist correctly and take effect immediately
5. ✓ Extension passes browser-specific validation requirements for distribution

**Distribution Readiness Checklist:**
- [ ] Chrome package verified working
- [ ] Firefox package verified working
- [ ] Edge package verified working
- [ ] No critical console errors in any browser
- [ ] Performance metrics acceptable across browsers
- [ ] Screenshots captured for store listings
- [ ] Privacy policy ready
- [ ] Store listing materials ready
- [ ] User approval received
</verification>

<success_criteria>
**Measurable Completion:**
- [ ] Extension tested in Chrome without critical issues
- [ ] Extension tested in Firefox without critical issues
- [ ] Extension tested in Edge without critical issues
- [ ] All Phase 1-5 requirements verified working across browsers
- [ ] Performance targets met (Memory <15MB, CPU 0% idle)
- [ ] No audio autoplay errors (verified audio removal effective)
- [ ] Screenshots captured for store submission
- [ ] User approves extension as ready for public distribution
- [ ] Phase 5 (Polish & Integration) complete
- [ ] Project ready for store submission
</success_criteria>

<output>
After completion, create `.planning/phases/05-polish-&-integration/05-04-SUMMARY.md` following the standard summary template.

Include:
- Cross-browser test results (pass/fail for each browser)
- Performance metrics (memory, CPU for each browser)
- Any browser-specific quirks or differences observed
- Screenshot locations
- User approval timestamp
- Final readiness confirmation
- Next steps: Manual store submission process (outside GSD workflow)

**Phase 5 completion marks project delivery milestone.**
</output>
