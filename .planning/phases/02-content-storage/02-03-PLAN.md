---
phase: 02-content-storage
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - public/images/defaults/*.jpg
  - lib/defaultImages.ts
  - entrypoints/options/index.html
  - entrypoints/options/App.tsx
  - entrypoints/options/style.css
autonomous: true

must_haves:
  truths:
    - "Extension includes 10-20 default nature landscape images"
    - "Default images are bundled in public/images/defaults/ directory"
    - "Default images load into IndexedDB on first install"
    - "User can access options page from browser extension settings"
  artifacts:
    - path: "public/images/defaults/"
      provides: "10-20 default nature landscape images"
      contains: "*.jpg"
    - path: "lib/defaultImages.ts"
      provides: "Default image loading logic"
      exports: ["loadDefaultImages", "DEFAULT_IMAGES"]
      min_lines: 40
    - path: "entrypoints/options/index.html"
      provides: "Options page entry HTML"
      contains: "<div id=\"root\"></div>"
    - path: "entrypoints/options/App.tsx"
      provides: "Options page root React component"
      exports: ["default"]
      min_lines: 20
  key_links:
    - from: "lib/defaultImages.ts"
      to: "lib/imageStorage.ts"
      via: "saveImage import"
      pattern: "import.*saveImage.*from.*imageStorage"
    - from: "entrypoints/options/App.tsx"
      to: "React"
      via: "ReactDOM.createRoot"
      pattern: "ReactDOM\\.createRoot"
---

<objective>
Bundle default nature landscape images and create options page scaffold for image management UI.

Purpose: Provide immediate value (users don't need to upload images to use extension) and establish the settings page structure where users will manage their image collection.

Output: 10-20 default images bundled in public/, loading logic for first install, and WXT options page entrypoint with React scaffold.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-content-storage/02-RESEARCH.md

# Created in Wave 1
@.planning/phases/02-content-storage/02-01-PLAN.md

# Existing WXT structure from Phase 01
@entrypoints/background.ts
@entrypoints/content/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bundle default nature landscape images</name>
  <files>public/images/defaults/*.jpg, lib/defaultImages.ts</files>
  <action>
Create public/images/defaults/ directory and populate with 15 default nature landscape images:

**Image sourcing:**
Use royalty-free images from Unsplash with Unsplash License (free for commercial use, no attribution required):

1. Download 15 nature landscape images from Unsplash:
   - Search: "nature landscape" "mountain" "forest" "ocean" "sunset"
   - Categories: Mountains, forests, oceans, lakes, sunsets, meadows, deserts
   - Variety: Different times of day, seasons, and landscapes

2. Image specifications:
   - Resolution: 1920x1080 (Full HD)
   - Format: JPEG
   - Quality: Optimized to <500KB each
   - Total bundle size: ~7.5MB (15 images × 500KB)

3. Naming convention:
   - nature-01.jpg through nature-15.jpg
   - Sequential numbering for easy reference

**Download and optimize images:**
```bash
mkdir -p public/images/defaults

# Example Unsplash URLs (use actual photo IDs):
# https://unsplash.com/photos/mountain-landscape-[photo-id]
# Download with size parameter: ?w=1920&q=85

# Use ImageMagick or similar to ensure specs:
# convert input.jpg -resize 1920x1080^ -quality 85 nature-01.jpg
```

**Create lib/defaultImages.ts with loading logic:**

```typescript
import { saveImage } from './imageStorage';
import { browser } from 'wxt/browser';

export const DEFAULT_IMAGES = [
  '/images/defaults/nature-01.jpg',
  '/images/defaults/nature-02.jpg',
  '/images/defaults/nature-03.jpg',
  '/images/defaults/nature-04.jpg',
  '/images/defaults/nature-05.jpg',
  '/images/defaults/nature-06.jpg',
  '/images/defaults/nature-07.jpg',
  '/images/defaults/nature-08.jpg',
  '/images/defaults/nature-09.jpg',
  '/images/defaults/nature-10.jpg',
  '/images/defaults/nature-11.jpg',
  '/images/defaults/nature-12.jpg',
  '/images/defaults/nature-13.jpg',
  '/images/defaults/nature-14.jpg',
  '/images/defaults/nature-15.jpg',
];

export async function loadDefaultImages() {
  const { openDB } = await import('idb');
  const db = await openDB('screen-saver-images', 1);
  const count = await db.count('images');

  // Only load if database is empty (first install)
  if (count > 0) {
    console.log('Default images already loaded, skipping');
    return;
  }

  console.log('Loading default images...');

  for (let i = 0; i < DEFAULT_IMAGES.length; i++) {
    const url = browser.runtime.getURL(DEFAULT_IMAGES[i]);

    try {
      const response = await fetch(url);
      const blob = await response.blob();

      await saveImage(
        `default-${i + 1}`,
        blob,
        `Default Nature ${i + 1}`,
        true // isDefault flag
      );

      console.log(`Loaded default image ${i + 1}/${DEFAULT_IMAGES.length}`);
    } catch (error) {
      console.error(`Failed to load default image ${i + 1}:`, error);
    }
  }

  console.log('Default images loaded successfully');
}
```

**Critical patterns:**
- Check database count BEFORE loading (avoid duplicates)
- Use browser.runtime.getURL for extension resource URLs
- Mark images with isDefault: true (prevents deletion)
- Sequential loading with error handling per image
- Log progress for debugging

**DO NOT:**
- Load defaults on every extension start (only first install)
- Use relative paths (use browser.runtime.getURL)
- Allow deletion of default images (enforced by isDefault flag)
  </action>
  <verify>
Check files exist:
```bash
ls -lh public/images/defaults/*.jpg | wc -l  # Should be 15
du -sh public/images/defaults  # Should be ~7-8MB
```

Check image sizes:
```bash
for f in public/images/defaults/*.jpg; do
  size=$(stat -f%z "$f")
  if [ $size -gt 524288 ]; then
    echo "WARNING: $f is larger than 500KB ($size bytes)"
  fi
done
```

Type check:
```bash
npm run type-check
```
  </verify>
  <done>
- public/images/defaults/ contains 15 JPEG files
- Each image is <500KB, 1920x1080 resolution
- lib/defaultImages.ts exports DEFAULT_IMAGES and loadDefaultImages()
- Loading logic checks database count before loading
- TypeScript types working
  </done>
</task>

<task type="auto">
  <name>Task 2: Create WXT options page entrypoint</name>
  <files>entrypoints/options/index.html, entrypoints/options/App.tsx, entrypoints/options/style.css</files>
  <action>
Create entrypoints/options/ directory with WXT options page structure:

**Create entrypoints/options/index.html:**
```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Open in dedicated tab instead of inline modal -->
  <meta name="manifest.open_in_tab" content="true" />
  <title>Screen Saver Settings</title>
</head>
<body>
  <div id="root"></div>
  <script type="module" src="./App.tsx"></script>
</body>
</html>
```

**Key meta tag:** `manifest.open_in_tab` = true opens settings in full tab (not inline modal).

**Create entrypoints/options/App.tsx:**
```typescript
import React from 'react';
import ReactDOM from 'react-dom/client';
import './style.css';

function OptionsApp() {
  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="container mx-auto max-w-4xl px-4">
        <header className="mb-8">
          <h1 className="text-4xl font-bold text-gray-900">Screen Saver Settings</h1>
          <p className="mt-2 text-gray-600">
            Manage your image collection and customize your screen saver experience
          </p>
        </header>

        <main>
          <div className="rounded-lg bg-white p-6 shadow">
            <p className="text-gray-600">
              Image management components will be added in the next plan.
            </p>
          </div>
        </main>
      </div>
    </div>
  );
}

const root = document.getElementById('root');
if (root) {
  ReactDOM.createRoot(root).render(
    <React.StrictMode>
      <OptionsApp />
    </React.StrictMode>
  );
}

export default OptionsApp;
```

**Create entrypoints/options/style.css:**
```css
@import "tailwindcss";
```

This imports Tailwind v4 (already configured in Phase 01 postcss.config.js).

**WXT auto-detection:**
- WXT scans entrypoints/ directory
- Finds options/index.html
- Generates manifest options_page field automatically
- Users can access via: Right-click extension icon → Options

**DO NOT:**
- Manually configure manifest options_page (WXT auto-generates)
- Use popup instead of options (popup is for quick actions, options is for settings)
- Skip "manifest.open_in_tab" (inline modal is cramped for image management)
  </action>
  <verify>
Build extension to verify WXT recognizes options entrypoint:
```bash
npm run build
```

Check generated manifest includes options_page:
```bash
cat .output/chrome-mv3/manifest.json | grep -A2 options
```

Type check:
```bash
npm run type-check
```
  </verify>
  <done>
- entrypoints/options/index.html exists with root div and module script
- entrypoints/options/App.tsx exists with React root component
- entrypoints/options/style.css exists with Tailwind import
- WXT build generates options_page in manifest
- Options page accessible from extension settings
- No TypeScript errors
  </done>
</task>

</tasks>

<verification>
After completing both tasks:
1. 15 default images exist in public/images/defaults/
2. lib/defaultImages.ts has loading logic with database check
3. Options page entrypoint exists and WXT recognizes it
4. Extension builds successfully with options_page in manifest
5. All images are <500KB and properly formatted
</verification>

<success_criteria>
- Default images bundled and ready for loading (CONT-01 fulfilled)
- Options page structure exists for Wave 3 UI components
- Extension can be opened from browser settings (right-click → Options)
- Foundation complete for image upload and management UI
</success_criteria>

<output>
After completion, create `.planning/phases/02-content-storage/02-03-SUMMARY.md` with:
- Default images sourced and bundled (count, total size)
- Options page entrypoint created
- WXT auto-detection verified
- Any decisions about image selection or layout
</output>
